<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.guet.item.mapper.PromoMapper">

    <resultMap id="BaseResultMap" type="cn.edu.guet.item.domain.Promo">
            <id property="id" column="id" />
            <result property="promoName" column="promo_name" />
            <result property="startDate" column="start_date" />
            <result property="endDate" column="end_date" />
            <result property="itemId" column="item_id" />
            <result property="promoItemPrice" column="promo_item_price" />
    </resultMap>

    <sql id="Base_Column_List">
        id,promo_name,start_date,end_date,item_id,promo_item_price
    </sql>

    <select id="selectItemDetailByItemId" resultType="cn.edu.guet.item.domain.ItemDetailDTO">
        SELECT
        i.id AS id,  <!-- 商品ID（原SQL错用了促销ID） -->
        i.title AS title,
        i.price AS price,
        i.description AS description,
        i.sales AS sales,
        i.img_url AS imgUrl,
        p.promo_name AS promoName,
        p.start_date AS startDate,
        p.end_date AS endDate,
        p.promo_item_price AS promoItemPrice,
        s.stock AS stock
        FROM item i  <!-- 主表改为商品表 -->
        LEFT JOIN promo p ON i.id = p.item_id  <!-- 商品关联促销 -->
        LEFT JOIN item_stock s ON i.id = s.item_id  <!-- 商品关联库存 -->
        WHERE i.id = #{itemId}  <!-- 条件改为商品ID -->

    </select>
    <select id="showPromos" resultType="cn.edu.guet.item.domain.ItemDetailDTO">
        SELECT
        i.id AS id,  <!-- 商品ID（原SQL错用了促销ID） -->
        i.title AS title,
        i.price AS price,
        i.description AS description,
        i.sales AS sales,
        i.img_url AS imgUrl,
        p.promo_name AS promoName,
        p.start_date AS startDate,
        p.end_date AS endDate,
        p.promo_item_price AS promoItemPrice,
        s.stock AS stock
        FROM item i  <!-- 主表改为商品表 -->
        LEFT JOIN promo p ON i.id = p.item_id  <!-- 商品关联促销 -->
        LEFT JOIN item_stock s ON i.id = s.item_id  <!-- 商品关联库存 -->



    </select>


</mapper>
